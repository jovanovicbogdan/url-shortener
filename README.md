## URL Shortener

Maps the original URL to a variable length characters string.

## Create Short URL

There are two API versions to create short URL.

First version creates hash based short URL code with `MurmurHash3`:

1. Hash original URL with `MurmurHash3.hash32x86()`
2. Take Base62 value of produced hash
3. Store short URL in the database, if unique constraint is violated then there was a collision

```
POST /api/v1/url
Content-Type: application/json

{
  "url": "https://long-url.com"
}
```

Second version creates short URL code based on a global counter hosted in Redis instance. The
incremented number is encoded using [Sqids](https://github.com/sqids/sqids-java) library reducing a
chance of collision to 0. There is also a benefit of no need to expire short URLs by default.

```
POST /api/v2/url
Content-Type: application/json

{
  "url": "https://long-url.com"
}
```

Both approaches will produce short URL of a variable length where the second approach gives an
option to set the minimum length of encoded ID generated by `Sqids` but the final outputted length
cannot be guaranteed.

Also, both APIs return 201 Created with Location header holding a value of a short URL.

## Redirect

```
GET /Gv
```

Returns 307 Temporary Redirect making it more suitable for tracking analytics. Returning 302 Moved
Permanently might be cached by clients avoiding a request to our server to collect analytical data.
The downside is that there will be more compute cost to our server than having clients caching it.

The API first checks if the key is present in Redis with provided short URL. If there is a cache
miss then go to the database (PostgreSQL) and fetch the original URL from there. Store in cache
value retrieved from the database.

There are two instances of Redis. For storing short URLs Redis is configured as LRU cache with the
memory limit of 100MB. Once the limit is exceeded than evict least recently used keys. Another
instance is for storing counter configured to `fsync` every second as AOF.

## TODO

- [x] ~~Use Redis for caching~~
- [x] ~~Request URL validation~~
- [x] ~~Handle storage overflow with generating a short URL for the same URL~~
- [x] ~~Add rate limiter~~
- [x] ~~As an addition to Base62, hash original url first with e.g. MurmurHash or CRC~~
- [x] ~~Reduce the number of characters, see how goo.gl did it or bit.ly, e.g. tinyurl uses 8
  chars~~
- [x] ~~Add URL alias and expiration~~
- [x] ~~Implement testing~~
- [ ] Implement basic analytics
